---

Copyright:
  years: 2019, 2020
lastupdated: "2020-10-02"

keywords: block storage, IBM Cloud, VPC, virtual private cloud, Key Protect, encryption, key management, Hyper Protect Crypto Services, HPCS, volume, data storage, virtual server instance, instance, customer-managed encryption

subcollection: vpc


---

{:shortdesc: .shortdesc}
{:codeblock: .codeblock}
{:important: .important}
{:screen: .screen}
{:pre: .pre}
{:table: .aria-labeledby="caption"}
{:note: .note}

# About data encryption for VPC
{: #vpc-encryption-about}

{{site.data.keyword.cloud_notm}} takes security seriously and understands the importance of encrypting data to keep it safe. Primary boot volumes and secondary data volumes are automatically encrypted using IBM-managed encryption. You can also choose to manage your own encryption for volumes and custom images. Customer-managed encryption lets you bring your own root keys to the cloud to encrypt volume and custom image passphrases. You retain complete control over your data.
{:shortdesc}

Customer-managed encryption for volumes and custom images lets you use root keys in the same region as you resources. You can also use root keys from another region to encrypt your resources. For more information, see [Root key regional and cross-regional considerations](#byok-cross-region-keys).

## IBM-managed encryption
{: #vpc-provider-managed-encryption}

By default, all boot and data volumes are encrypted at rest with IBM provider-managed encryption. There is no additional cost for this service or impact on performance. Provider-managed encryption uses the following industry standard protocols:

* AES-256 encryption
* Keys are managed in-house with Key Management Interoperability Protocol (KMIP)
* Storage is validated for Federal Information Processing Standard (FIPS) Publication 140-2, Federal Information Security Management Act (FISMA), Health Insurance Portability and Accountability Act (HIPAA). Storage is also validated for Payment Card Industry (PCI), Basel II, California Security Breach Information Act (SB 1386), and EU Data Protection Directive 95/46/EC compliance.

## Customer-managed encryption
{: #vpc-customer-managed-encryption}

With customer-managed encryption, you provision customer root keys (CRKs) to protect your encrypted resources in the cloud. Root keys serve as key-wrapping keys that safeguard LUKS passphrases.  You decide whether to import your existing root keys ("bring your own key"), or have a supported IBM key management service (KMS) create one for you. 

Block storage volumes are assigned a unique master encryption key generated by the instance's host hypervisor. The master key for each volume is encrypted with a unique KMS-generated LUKS passphrase, which is then encrypted by the CRK and stored in the KMS. 

Custom images are encrypted by your own LUKS passphrase you create by using QEMU. After the image is encrypted, you wrap the passphrase with your CRK stored in the KMS.

You can choose {{site.data.keyword.keymanagementserviceshort}} or {{site.data.keyword.hscrypto}} (HPCS) as your KMS. Both provide envelope encryption, which wraps your secret passphrase with your CRK and creates a wrapped data encryption key (WDEK). Root keys in HPCS service instances are also protected by a hardware security module (HSM) master key. The KMS stores your key and makes it available during volume and custom image encryption. You also manage your keys in the KMS. For more information, see [Supported key management services for customer-managed encryption](#kms-for-byok).

After provisioning the key management service, you must authorize access between Cloud Block Storage (source service) and the KMS.

Customer-managed encryption is available for creating custom images, boot voumes, and data volumes. Data in the instance's boot volume is encrypted using the [custom image encryption](/docs/vpc?topic=vpc-create-encrypted-custom-image). You can also encrypt the boot volume using a different root key. [Data volumes](/docs/vpc?topic=vpc-block-storage-about#secondary-data-volumes) are encrypted using their own CRKs when you provision a virtual server instance or when you create a standalone volume.

### Advantages of customer-managed encryption
{: #byok-advantages}

Customer-managed encryption gives you the following advantages over provider-managed encryption:

* Encryption keys are controlled by you. You grant IBM access to use your root keys to encrypt your data.
* Data is encrypted while in transit and while at rest.
* You can encrypt boot and data volumes. 
* You can encrypt [custom images](/docs/vpc?topic=vpc-create-encrypted-custom-image) by importing a QCOW2 boot image file protected by your root key. The data in the instance's boot volume is also encrypted.
* You choose the [key management service (KMS)](#kms-for-byok) you want to use. You can select {{site.data.keyword.keymanagementserviceshort}}, a public multi-tenant KMS that is FIPS 140-2 L3 compliant, or the more secure {{site.data.keyword.hscrypto}}, which is FIPS 140-2 L4 compliant.
* Customer-managed encryption provides better audit records for root key usage. Your key access is logged in the [Activity Tracker](/docs/vpc?topic=vpc-vpc-encryption-managing#byok-activity-tracker-events) with LogDNA service. The Activity Tracker lets you track interactions with the VPC, such as when a root key is rotated.
* You can manually rotate your root keys using the API or CLI, or set up a rotation policy to automatically rotate your keys. Rotating keys replaces the root key's original cryptographic material and generates new material. For more inforation, see [Key Rotation for VPC resources](/docs/vpc?topic=vpc-vpc-key-rotation).

### IBM's encryption technology - How your data is secured
{: #byok-technologies}

Encryption is handled by IBM's host/hypervisor technology for your instances. This feature provides greater level of security over solutions that only provide storage node encryption. Data is always encrypted with your root key outside the host/hypervisor. Your data is protected while in transit between the host system and IBM's storage systems, and while at rest in IBM's storage system.

Communication between the host system and IBM's storage systems is also encrypted using Transport Layer Security (TLS) encryption technology using IBM-managed keys. When your data is in transit, it's encrypted twice; first with your AES-256 master encryption key and then with IBM's TLS encryption key.

For more information about technologies used for customer-managed encryption, see [Data security and encryption questions](/docs/vpc?topic=vpc-block-storage-vpc-faq#block-storage-vpc-security-questions) in the {{site.data.keyword.block_storage_is_short}} FAQs.

### Root key regional and cross-regional considerations
{: #byok-cross-region-keys}

Customer-managed encryption for volumes and images lets you keep your root keys in the same region as your resources, or in a different region (cross-regional). 

When you use root keys in the same region as your resources, all network traffic is directed to a private endpoint. That is, your keys encrypt and decrypt resources over a private network that's inaccessible to the Internet. In contrast, when your keys are in a different region than your resource, the key material must transmit over a public network, exposing it to the Internet.

Cross-regional keys offer more key availability with the tradeoff of slightly higher latency. You can create and manage root keys in one region and apply them to resources in another region. Cross-regional keys are available in the US, EU, and AP regions.

As best practice, use root keys in the same region as your resources. Regional service uses private endpoints to multiple availability zones. If a given zone is unavailable, you can continue to access your root keys and encrypted resources from another zone.

### About encrypted custom images
{: #byok-about-encrypted-images}

You can create a QCOW2 custom image that meets the requirements for {{site.data.keyword.vpc_short}} infrastructure and [encrypt it](/docs/vpc?topic=vpc-create-encrypted-custom-image#manually-encrypt-image) by using your own LUKS passphrase and root key (CRK). After you encrypt the custom image with your own passphrase, you upload it to {{site.data.keyword.cos_full_notm}}. 

To import an encrypted custom image to {{site.data.keyword.vpc_short}}, you first need to set up a key management service (KMS) instance, either {{site.data.keyword.keymanagementserviceshort}} or {{site.data.keyword.hscrypto}}. In the KMS instance, you create a CRK that's used to wrap (encrypt) the passphrase. Wrapping the passphrase produces a wrapped data encryption key (WDEK). The WDEK protects the passphrase at import time, keeping your data secure. (The passphrase is stored encrypted at all times in the image service and unwrapped only when a virtual server that uses the encrypted image is started.) 

With the required IAM authorizations in place, you then import the encrypted image from {{site.data.keyword.cos_full_notm}}. You import the image to {{site.data.keyword.vpc_short}} and  specify the cloud resource name (CRN) for your CRK stored in the KMS. You also specify the ciphertext for your WDEK, which is the passphrase that you use to encrypt your image, wrapped by the CRK.

When you import using the API or UI, you supply a single QCOW2 boot image file that can be up to 100 GB. This file is private to the account to which it's imported. The region where you import the encrypted image is the region where you create virtual server instances from that image. The encrypted image displays with other custom images that you have permission to use. In the UI, a lock icon next to the name indicates it's an encrypted custom image.

When it's time to provision a new virtual server instance with the encrypted image, no other encryption information is needed. The WDEK and the CRN of the CRK are stored as metadata with the image. The WDEK is used to access the encrypted image when a virtual server instance that uses the encrypted image is started.

At provision time, data in the instance's boot volume is also encrypted by using the same CRK that the custom image uses along with a generated passphrase. Alternatively, you can provide a different root key for the boot volume.

After the virtual server instance is created you can view the custom image and see the root key CRN. You can also [rotate the root key](/docs/vpc?topic=vpc-vpc-key-rotation) and be notified by the KMS when your encrypted image WDEK is automatically re-wrapped (re-encrypted).

Any secondary volumes you create and attach from the encrypted custom image use a different passphrase than the base custom image. Optionally, you can provide a different root key for secondary volumes created during instance provisioning.  

Custom encrypted images is available for Gen 2 compute resources only.
{:note}

## Supported key management services for customer-managed encryption
{: #kms-for-byok}

Two IBM key management services (KMS) are available for customer-managed encyryption, {{site.data.keyword.keymanagementserviceshort}} and {{site.data.keyword.hscrypto}} (available in certain [regions](/docs/hs-crypto?topic=hs-crypto-regions#regions)). These services use a common key provider API to provide a consistent approach for managing your encryption keys. 

Table 1 describes these services:

| Key Management Service | HSM Encryption Certification | Description |
| ----- | ----- |
| [{{site.data.keyword.keymanagementserviceshort}}](/docs/key-protect/concepts?topic=key-protect-getting-started-tutorial) | FIPS 140-2 *Level 3* compliance | A multi-tenant KMS that lets you import or create your root keys and securely manage them.  |
| [{{site.data.keyword.hscrypto}}](/docs/hs-crypto?topic=hs-crypto-get-started) | FIPS 140-2 *Level 4* compliance | Highest level of security; a single-tenant KMS and hardware security module (HSM) that's controlled by you.  Import or create your root keys and securely manage them. Create a HSM master key to encrypt the content of key storage, including root keys. Only you have access to your keys and data. |
{: caption="Table 1. Available key management service options" caption-side="top"}

## General procedure for setting up customer-managed encryption
{: #byok-general-prodedure}
Setting up customer-managed encryption for your block storage volumes involves several steps. Here's the general procedure:

1. Generate your own root key from your on-premises HSM. Optionally, create your root key by using an IBM Cloud HSM or use {{site.data.keyword.hscrypto}}, which includes an HSM.
1. Provision the key management service (KMS) that best meets your needs.
1. Use your KMS to securely import your root key to the cloud service. For added security, create an import token in your KMS to encrypt and import root keys to the service. 
1. {{site.data.keyword.cloud_notm}} data centers provide a dedicated HSM to create and protect your keys. Using {{site.data.keyword.hscrypto}}, you can take control of your cloud data encryption keys and cloud hardware security module.
1. From IBM {{site.data.keyword.iamshort}} (IAM), authorize service between Cloud Block Storage (source service) and your KMS (target service). For custom images, also authorize between Image Service for VPC and IBM Cloud Object Storage.
1. The {{site.data.keyword.cloud_notm}} infrastructure uses your root key to secure the data by wrapping the passphrases for volumes or custom images. For custom images, your root key wraps your passphrase before you import the custom image file to the cloud. For more information, see [About encrypted custom images](#byok-about-encrypted-images).
1. Manage your keys in your KMS. For example, you can disable your root key to ensure that the IBM-managed keys' associated data can [no longer be accessed or decrypted](/docs/vpc?topic=vpc-vpc-encryption-managing#instance-byok-inaccessible-data). You can also [rotate your customer-managed root keys](/docs/vpc?topic=vpc-vpc-key-rotation). Rotating your root keys lets you roll out a new key across the resources that were protected by the old key.

## Flow diagrams for specifying customer-managed encryption for volumes
{: #byok-flow-diagrams-volumes}

You can specify customer-managed encryption when you create a new block storage volume during instance provisioning. You can also specify it when you create a volume outside instance provisioning.

Figure 1 shows the procedure for creating a data volume with customer-managed encryption during instance provisioning. The volume is automatically attached to the instance.

![Figure showing the procedure for creating an instance with a customer-managed encrypted volume.](/images/vpc_flowchart_instances_color.png "Figure showing the procedure for creating an instance with a customer-managed encrypted volume"){: caption="Figure 1. Creating an instance with a customer-managed encrypted volume" caption-side="bottom"}

Figure 2 shows the procedure for creating a standalone volume and then attaching it to an instance.

![Figure showing the procedure for creating block storage volumes with customer-managed encryption.](/images/vpc_flowchart_volumes_color.png "Figure showing the procedure for creating block storage volumes with customer-managed encryption"){: caption="Figure 2. Creating a block storage volume with customer-managed encryption" caption-side="bottom"}

## Flow diagram for specifying customer-managed encryption for custom images
{: #byok-flow-diagram-images}

Figure 3 shows the procedure for encrypted custom images using your own encryption keys. 

![Figure showing the procedure for creating encrypted custom images.](/images/vpc-flowchart-encrypted-images-color.png "Figure showing the procedure for creating encrypted custom images"){: caption="Figure 3. Creating custom images with customer-managed encryption" caption-side="bottom"}

## Next Steps
{: #byok-about-next-steps}

* [Review the checklist](/docs/vpc?topic=vpc-vpc-encryption-planning#planning-for-data-encryption) for planning data encryption and complete the [prerequisites](/docs/vpc?topic=vpc-vpc-encryption-planning#byok-encryption-prereqs).
* [Create virtual server instances with customer-managed encryption volumes](/docs/vpc?topic=vpc-creating-instances-byok).
* [Create a block storage volume with customer-managed encryption](/docs/vpc?topic=vpc-block-storage-vpc-encryption).
